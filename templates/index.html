<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Imce Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Overall Page Styles -->
  <style>
    /* Base Reset and Typography */
    body {
      margin: 0;
      padding: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background-color: white;
      color: #333;
    }

    /* Header and Navigation */
    header {
      background-color: #d50060;
      color: #fff;
      padding: 1rem 2rem;
    }
    nav ul {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
    }
    nav li {
      margin-right: 1rem;
    }
    nav a {
      color: #fff;
      text-decoration: none;
      font-weight: bold;
    }

    /* Main Content */
    main {
      padding: 2rem;
      max-width: 1000px;
      margin: 2rem auto;
      background-color: #f5f5f5;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      border-radius: 8px;
    }
    main h1 {
      margin-top: 0;
      text-align: center;
      font-size: 2.5rem;
      color: #333;
    }
    main p {
      font-size: 1.1rem;
      line-height: 1.6;
    }

    /* Footer */
    footer {
      text-align: center;
      padding: 1rem;
      background-color: #d50060;
      color: #fff;
    }

    /* Streaming Container */
    #heygen-streaming-embed {
      z-index: 9999;
      position: fixed;
      display: flex;              /* consistent in both states */
      flex-direction: column;
      top: calc(100vh - 200px - 40px);
      left: calc(100vw - 200px - 40px);
      width: 200px;
      height: 200px;
      background-color: #fff;
      border-radius: 50%;
      border: 4px solid #fff;
      box-shadow: 0px 8px 24px rgba(0, 0, 0, 0.12);
      transition:
        width 0.3s ease-in-out,
        height 0.3s ease-in-out,
        top 0.3s ease-in-out,
        left 0.3s ease-in-out,
        bottom 0.3s ease-in-out,
        right 0.3s ease-in-out,
        border-radius 0.3s ease-in-out;
      overflow: hidden;
      cursor: pointer;
    }
    #heygen-streaming-embed.expand {
      width: 33vw;
      height: calc(100vh - 10px);
      border-radius: 8px;
      border: 5px;
      right: auto;
      bottom: auto;
      top: 5px;    /* 5px from top */
      left: calc(100vw - 33vw - 5px);
      overflow: hidden;
      cursor: default;
    }
    /* Hide overlay when not expanded */
    #heygen-streaming-embed:not(.expand) #overlay {
      display: none;
    }

    /* Media Elements */
    #mediaElement {
      width: 100%;
      height: 35%;
      object-fit: cover;
      position: relative;
      top: 0;
      left: 0;
      display: block;
      z-index: 1;
      border: 5px solid #d50060;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
      border-bottom-left-radius: 0;
      border-bottom-right-radius: 0;
      box-sizing: border-box;
      border-bottom-width: 20px;
    }

    /* Fallback Image */
    #fallbackImage {
      position: relative;
      top: 0;
      left: 0;
      width: 100%;
      height: 35%;
      object-fit: cover;
      z-index: 2;
      display: block;  /* always when no session */
      border: 5px solid #d50060;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
      border-bottom-left-radius: 0;
      border-bottom-right-radius: 0;
      box-sizing: border-box;
      border-bottom-width: 20px;
    }
    #heygen-streaming-embed.expand #fallbackImage {
      filter: brightness(70%);
    }

    /* Controls: Start Button & Loader */
    #startSessionBtn {
      position: absolute;
      top: 15%;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1rem;
      background-color: #d50060;
      color: white;
      padding: 10px 20px;
      border-radius: 30px;
      cursor: pointer;
      z-index: 100;
      font-weight: bold;
      text-align: center;
      border: none;
      box-shadow: none;
      font-family: 'Inter', sans-serif;
    }
    .loader {
      display: none;
      border: 7px solid #f3f3f3;    /* Light grey */
      border-top: 7px solid #d50060;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 2s linear infinite;
      position: absolute;
      top: 18%;
      left: 50%;
      z-index: 100;
    }
    @keyframes spin {
      from {
        transform: translate(-50%, -50%) rotate(0deg);
      }
      to {
        transform: translate(-50%, -50%) rotate(360deg);
      }
    }
    #startSessionBtn.loading {
      display: none;
      visibility: hidden;
    }
    #startSessionBtn.loading ~ .loader {
      display: block;
    }

    /* Minimize Button */
    #minimizeBtn {
      display: none;
      position: absolute;
      top: 8px;
      left: 8px;
      background: transparent;
      border: none;
      color: #fff;
      font-size: 3rem;
      line-height: 1;
      cursor: pointer;
      z-index: 200;
      text-shadow: 0 0 7px black;
    }
    /* Show only when expanded */
    #heygen-streaming-embed.expand #minimizeBtn {
      display: block;
    }

    #pauseBtn {
      position: absolute;
      top: 29%;
      left: 12px;
      width: 28px;
      height: 28px;
      padding: 0;

      background: transparent;
      color: #fff;
      border: none;
      outline: none;
      border-radius: 4px;

      /* center the icon */
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-family: 'Inter', sans-serif;
       /* sizing of the emoji */
      font-size: 2.2rem;
      line-height: 28px;    /* prevents extra line-height bumps */
      z-index: 10;
      display: none;
      text-shadow: 0 0 7px black;
    }

    #heygen-streaming-embed.expand #pauseBtn {
      display: flex;
    }


    /* Chat Overlay */
    #overlay {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 65%;  /* adjust as needed */
      background: #d50060;
      color: #fff;
      padding: 0 5px 5px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: 5px;
      z-index: 3;
    }

    /* Chat History */
    #chatHistory {
      flex: 1;
      overflow-y: auto;
      font-size: 1rem;
      background: white;
      padding: 10px 10px;
      border-radius: 4px;
      color: black;
      display: flex;
      flex-direction: column;
      gap: 5px;
      font-family: 'Inter', sans-serif;
      margin-top: 0 !important;
    }
    .chat-message {
      max-width: 70%;
      padding: 10px 15px;
      margin: 5px;
      border-radius: 15px;
      background-color: #d50060;
      color: #fff;
      align-self: flex-end;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .chat-message p:first-child,
    .chat-message p:last-child {
      display: inline;
      margin: 0;
      padding: 0;
    }

    /* Talk Section */
    #talk-section {
      display: flex;
      align-items: center;
      --control-height: 32px;
    }
    #talk-section textarea {
      flex-grow: 1;
      padding: 5px;
      margin-right: 5px;
      font-size: 1rem;
      font-family: 'Inter', sans-serif;
      border: 1px solid #ccc;
      border-radius: 4px;
      color: #000;
      resize: none;
      overflow: hidden;
      line-height: 1.5em;
      box-sizing: border-box;
      min-height: var(--control-height);
      max-height: 150px;
      overflow-y: auto !important;
    }
    #talk-section button {
      height: var(--control-height);
      background-color: #FFB6C1;
      color: black;
      cursor: pointer;
      font-weight: bold;
      font-family: 'Inter', sans-serif;
      border: none;
      border-radius: 4px;
      margin-right: 5px;
      font-size: 0.9rem;
    }
    #talk-section input {
      flex-grow: 1;
      border: 1px solid #ccc;
      color: #000;
    }

    /* Chat Prompt */
    #chatPrompt {
      position: absolute;
      top: 80%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 0.7rem;
      background-color: #d50060;
      color: white;
      padding: 7px 15px;
      border-radius: 30px;
      cursor: pointer;
      z-index: 10;
      font-weight: bold;
      text-align: center;
      font-family: 'Inter', sans-serif;
    }
    #heygen-streaming-embed.expand #chatPrompt {
      display: none;
    }

    /* Minimized States */
    /* Hide everything when minimized & no session */
    #heygen-streaming-embed:not(.expand) > * {
      display: none !important;
    }
    /* Show fallback & prompt when minimized without session */
    #heygen-streaming-embed:not(.expand):not(.session-active) > #fallbackImage {
      display: block !important;
      width: 100% !important;
      height: 100% !important;
      object-fit: cover !important;
      border: none !important;
      border-radius: inherit !important;
    }
    #heygen-streaming-embed:not(.expand):not(.session-active) > #chatPrompt {
      display: block !important;
    }
    /* Show media when minimized with active session */
    #heygen-streaming-embed:not(.expand).session-active > #mediaElement {
      display: block !important;
      width: 100% !important;
      height: 100% !important;
      object-fit: cover !important;
      border: none !important;
      border-radius: inherit !important;
    }

    /* Microphone Button */
    #micBtn {
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #micBtn svg {
      width: 1.25rem;
      height: 1.25rem;
      stroke: currentColor;
    }
    #micBtn #micIcon {
      display: block;
    }
    #micBtn #recIcon {
      display: none;
    }
    #micBtn.recording #micIcon {
      display: none;
    }
    #micBtn.recording #recIcon {
      display: block;
      fill: #fff;
      stroke: #fff;
    }
    #micBtn.recording {
      background-color: #d50000;
    }
  </style>
  <!-- Include LiveKit Client Library -->
  <script src="https://cdn.jsdelivr.net/npm/livekit-client/dist/livekit-client.umd.min.js"></script>
  <!-- Markdown-it from jsDelivr CDN -->
  <script src="https://cdn.jsdelivr.net/npm/markdown-it@13.0.1/dist/markdown-it.min.js"></script>

</head>
<body>
<!-- Header / Navigation -->
<header>
  <nav>
    <ul>
      <li><a href="#">Home</a></li>
      <li><a href="#">Features</a></li>
      <li><a href="#">Contact</a></li>
    </ul>
  </nav>
</header>

<!-- Main Content -->
<main>
  <h1>Voorbeeld pagina om te chatten met Imce</h1>
  <p>
    Welkom op onze website! Hier kun je kennismaken met onze interactieve avatar Imce. Imce staat voor je klaar om je te helpen en vragen te beantwoorden. Begin een gesprek en ontdek hoe Imce jouw ervaring persoonlijker maakt.
  </p>
</main>

<!-- Footer -->
<footer>
  <p>&copy; 2025 MMG Waalre</p>
</footer>

<!-- Streaming Container (Avatar) -->
<div id="heygen-streaming-embed">
  <!-- Chat prompt overlay for minimized state -->
  <div id="chatPrompt">Klik hier voor vragen</div>
  <!-- Fallback image is always shown when no session is active -->
  <img id="fallbackImage" src="{{ url_for('static', filename='preview_target.webp') }}" alt="Avatar fallback">
  <!-- The video element fills the container (hidden until session starts) -->
  <video id="mediaElement" autoplay playsinline style="display: none;"></video>
  <!-- Start button shown when expanded and no session is active -->
  <button id="startSessionBtn">Start</button>
  <button id="minimizeBtn" title="Minimize">×</button>
  <button id="pauseBtn" title="Pauze"  style="display:none">⏸</button>
  <div class="loader"></div>
  <!-- Overlay for chat and controls -->
  <div id="overlay">
    <!-- Chat History: shows only chat messages -->
    <div id="chatHistory">
      <div>
        <p>Welkom! Ik ben Imce! Klik hierboven op <b>Start</b> om me tot leven te brengen, en typ hieronder je bericht om met me te chatten. Ik sta klaar om je te helpen!</p>
      </div>
    </div>
    <!-- Talk Section with Toggle, Text Field, Talk Button, and Microphone Button -->
    <div id="talk-section">
      <textarea
              id="taskInput"
              placeholder="Je vraag of bericht ..."
              rows="1"
              style="resize: none; overflow: hidden;"
      ></textarea>
      <button id="talkBtn">Stuur</button>
      <button id="micBtn" title="Start spraak">
        <!-- normal outline mic -->
        <svg id="micIcon" fill="#000000" width="800px" height="800px" viewBox="0 0 36 36" version="1.1"  preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <title>microphone-solid</title>
          <path d="M18,24c3.9,0,7-3.1,7-7V9c0-3.9-3.1-7-7-7s-7,3.1-7,7v8C11,20.9,14.1,24,18,24z" class="clr-i-solid clr-i-solid-path-1"></path>
          <path d="M30,17h-2c0,5.5-4.5,10-10,10S8,22.5,8,17H6c0,6.3,4.8,11.4,11,11.9V32h-3c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1
		s-0.4-1-1-1h-3v-3.1C25.2,28.4,30,23.3,30,17z" class="clr-i-solid clr-i-solid-path-2"></path>
        </svg>
        <!-- recording solid mic (white) -->
        <svg id="recIcon" width="800px" height="800px" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 10L3 14M7.5 6L7.5 18M12 3V21M16.5 6V18M21 10V14" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
  </div>
</div>

<!-- Streaming API Script -->
<script type="module" src="{{ url_for('static', filename='streaming.js') }}"></script>
</body>
</html>
