<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Imce Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Overall Page Styles -->
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background-color; white;
      color: #333;
    }
    header {
      background-color: #d50060;
      color: #fff;
      padding: 1rem 2rem;
    }
    nav ul {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
    }
    nav li {
      margin-right: 1rem;
    }
    nav a {
      color: #fff;
      text-decoration: none;
      font-weight: bold;
    }
    main {
      padding: 2rem;
      max-width: 1000px;
      margin: 2rem auto;
      background-color: #f5f5f5;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      border-radius: 8px;
    }
    main h1 {
      margin-top: 0;
      text-align: center;
      font-size: 2.5rem;
      color: #333;
    }
    main p {
      font-size: 1.1rem;
      line-height: 1.6;
    }
    footer {
      text-align: center;
      padding: 1rem;
      background-color: #d50060;
      color: #fff;
    }
    /* Streaming Container (Avatar) Styles */
    #heygen-streaming-embed {
      z-index: 9999;
      position: fixed;
      right: 40px;
      bottom: 40px;
      width: 200px;
      height: 200px;
      background-color: #fff;
      border-radius: 50%;
      border: 2px solid #fff;
      box-shadow: 0px 8px 24px rgba(0, 0, 0, 0.12);
      transition: all linear 0.2s;
      overflow: hidden;
      cursor: pointer;
    }
    /* Expanded state: container is larger and rectangular */
    #heygen-streaming-embed.expand {
      width: 33vw;
      height: calc(100vh - 10px);
      border-radius: 8px;
      border: 5px;
      top: 5px;
      right: 0;
      bottom: 5px;
      left: auto;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    /* Hide overlay when not expanded */
    #heygen-streaming-embed:not(.expand) #overlay {
      display: none;
    }
    /* Video element fills the container */
    #mediaElement {
      width: 100%;
      height: 35%;
      object-fit: cover;
      position: relative;
      top: 0;
      left: 0;
      display: block;
      z-index: 1;
      border: 5px solid #d50060;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
      border-bottom-left-radius: 0;
      border-bottom-right-radius: 0;
      box-sizing: border-box;

    }
    /* Fallback image styling */
    #fallbackImage {
      position: relative;
      top: 0;
      left: 0;
      width: 100%;
      height: 35%;
      object-fit: cover;
      z-index: 2;
      /* Always visible when no session is active */
      display: block;
      border: 5px solid #d50060;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
      border-bottom-left-radius: 0;
      border-bottom-right-radius: 0;
      box-sizing: border-box;

    }
    /* Start button (only in expanded mode when no session is active) */
    #startSessionBtn {
      display: none;
      position: absolute;
      top: 20%;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1rem;
      background-color: #d50060; /* your pink */
      color: white;               /* text color */
      padding: 10px 20px;
      border-radius: 30px;       /* pill shape */
      cursor: pointer;
      z-index: 100;
      font-weight: bold;
      text-align: center;
      border: none;         /* remove border */
      box-shadow: none;
      font-family: 'Inter', sans‑serif;
    }
    /* Overlay for chat and controls */
    #overlay {
      position: absolute;
      bottom: 0;
      width: 100%;
      /* Define a fixed or relative height for the overlay if needed */
      height: 65%; /* This is an example value; adjust as desired */
      background: #d50060;
      color: #fff;
      padding: 5px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: 5px;
      z-index: 3;
    }

     /* Chat history styling: always visible and flexible */
    #chatHistory {
      flex: 1;
      overflow-y: auto;
      font-size: 1rem;
      background: white;
      padding: 5px;
      border-radius: 4px;
      color: black;
      display: flex;
      flex-direction: column;
      gap: 5px;
      font-family: 'Inter', sans‑serif;
    }
    /* New chat bubble styling for user messages */
    .chat-message {
      max-width: 70%;
      padding: 10px 15px;
      margin: 5px;
      border-radius: 15px;
      background-color: #d50060;
      color: #fff;
      align-self: flex-end;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }


    /* Talk section controls */
    #talk-section {
      display: flex;
      align-items: center;
    }
    #talk-section button, #talk-section input {
      padding: 5px;
      border: none;
      border-radius: 4px;
      margin-right: 5px;
      font-size: 0.9rem;
      font-weight: bold;
      font-family: 'Inter', sans‑serif;
    }
    #talk-section input {
      flex-grow: 1;
      border: 1px solid #ccc;
      color: #000;
    }
    #talk-section button {
      background-color: #FFB6C1;
      color: black;
      cursor: pointer;
      font-weight: bold;
      font-family: 'Inter', sans‑serif;
    }
    /* Toggle chat history button style */
    #toggleChatBtn {
      background-color: #d50060;
      color: #fff;
      cursor: pointer;
      font-weight: bold;
      font-family: 'Inter', sans‑serif;
    }
    /* Chat prompt styling: visible only in minimized mode */
    #chatPrompt {
      position: absolute;
      top: 80%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 0.7rem;
      background-color: #d50060; /* your pink */
      color: white;               /* text color */
      padding: 7px 15px;
      border-radius: 30px;       /* pill shape */
      cursor: pointer;
      z-index: 10;
      font-weight: bold;
      text-align: center;
      font-family: 'Inter', sans‑serif;
    }
    /* Hide the chat prompt when the container is expanded */
    #heygen-streaming-embed.expand #chatPrompt {
      display: none;
    }
    /* 1) Hide everything when minimized & no session */
    #heygen-streaming-embed:not(.expand) > * {
      display: none !important;
    }

    /* 2) Show & stretch only the fallback image */
    #heygen-streaming-embed:not(.expand):not(.session-active) > #fallbackImage {
      display: block !important;
      width: 100% !important;
      height: 100% !important;
      object-fit: cover !important;
      border: none !important;
      border-radius: inherit !important;
    }

    /* 3) Keep the chat prompt visible when minimized */
    #heygen-streaming-embed:not(.expand):not(.session-active) > #chatPrompt {
      display: block !important;
    }

    /* 4) Minimized & session-active: show ONLY the mediaElement, filling the circle */
    #heygen-streaming-embed:not(.expand).session-active > #mediaElement {
      display: block !important;
      width: 100% !important;
      height: 100% !important;
      object-fit: cover !important;
      border: none !important;
      border-radius: inherit !important;
    }
    /* Mic button: same height as input, minimal padding */
    #micBtn {
      background: none;
      border: none;
      padding: 0;                  /* kill default padding */
      margin: 0;                   /* kill default margin */
      height: 1.7rem;              /* match your input’s ~2.5rem height */
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    /* SVG: slightly smaller than the button, perfectly centered */
    #micBtn svg {
      width: 1rem;
      height: 1rem;
      stroke: currentColor;        /* inherit your button/text color */
    }

  </style>
  <!-- Include LiveKit Client Library -->
  <script src="https://cdn.jsdelivr.net/npm/livekit-client/dist/livekit-client.umd.min.js"></script>
</head>
<body>
<!-- Header / Navigation -->
<header>
  <nav>
    <ul>
      <li><a href="#">Home</a></li>
      <li><a href="#">Features</a></li>
      <li><a href="#">Contact</a></li>
    </ul>
  </nav>
</header>

<!-- Main Content -->
<main>
  <h1>Voorbeeld pagina om te chatten met Imce</h1>
  <p>
    Welkom op onze website! Hier kun je kennismaken met onze interactieve avatar Imce. Imce staat voor je klaar om je te helpen en vragen te beantwoorden. Begin een gesprek en ontdek hoe Imce jouw ervaring persoonlijker maakt.
  </p>
</main>

<!-- Footer -->
<footer>
  <p>&copy; 2025 MMG Waalre</p>
</footer>

<!-- Streaming Container (Avatar) -->
<div id="heygen-streaming-embed">
  <!-- Chat prompt overlay for minimized state -->
  <div id="chatPrompt">Klik hier om te chatten</div>
  <!-- Fallback image is always shown when no session is active -->
  <img id="fallbackImage" src="{{ url_for('static', filename='preview_target.webp') }}" alt="Avatar fallback">
  <!-- The video element fills the container (hidden until session starts) -->
  <video id="mediaElement" autoplay playsinline style="display: none;"></video>
  <!-- Start button shown when expanded and no session is active -->
  <button id="startSessionBtn">Start</button>
  <!-- Overlay for chat and controls -->
  <div id="overlay">
    <!-- Chat History: shows only chat messages -->
    <div id="chatHistory"></div>
    <!-- Talk Section with Toggle, Text Field, Talk Button, and Microphone Button -->
    <div id="talk-section">
      <input id="taskInput" type="text" placeholder="Je vraag of bericht ...">
      <button id="talkBtn">Stuur</button>
      <button id="micBtn" title="Start spraak">
        <!-- Heroicon “microphone” (outline) -->
        <svg xmlns="http://www.w3.org/2000/svg" width="800px" height="800px" viewBox="0 0 16 16" fill="none">
          <path d="M5 3C5 1.34315 6.34315 0 8 0C9.65685 0 11 1.34315 11 3V7C11 8.65685 9.65685 10 8 10C6.34315 10 5 8.65685 5 7V3Z" fill="#000000"/>
          <path d="M9 13.9291V16H7V13.9291C3.60771 13.4439 1 10.5265 1 7V6H3V7C3 9.76142 5.23858 12 8 12C10.7614 12 13 9.76142 13 7V6H15V7C15 10.5265 12.3923 13.4439 9 13.9291Z" fill="#000000"/>
        </svg>
      </button>
    </div>
  </div>
</div>

<!-- Streaming API Script -->
<script type="module" src="{{ url_for('static', filename='streaming.js') }}"></script>
</body>
</html>
