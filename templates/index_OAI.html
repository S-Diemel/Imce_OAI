<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Imce Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Overall Page Styles -->
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background-color: white;
      color: #333;
    }
    header {
      background-color: #d50060;
      color: #fff;
      padding: 1rem 2rem;
    }
    nav ul {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
    }
    nav li {
      margin-right: 1rem;
    }
    nav a {
      color: #fff;
      text-decoration: none;
      font-weight: bold;
    }
    main {
      padding: 2rem;
      max-width: 1000px;
      margin: 2rem auto;
      background-color: #f5f5f5;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      border-radius: 8px;
    }
    main h1 {
      margin-top: 0;
      text-align: center;
      font-size: 2.5rem;
      color: #333;
    }
    main p {
      font-size: 1.1rem;
      line-height: 1.6;
    }
    footer {
      text-align: center;
      padding: 1rem;
      background-color: #d50060;
      color: #fff;
    }
    /* Streaming Container (Avatar) Styles */
    #heygen-streaming-embed {
      z-index: 9999;
      position: fixed;
      display: flex;              /* same in both states so we don’t break the transition */
      flex-direction: column;
      top: calc(100vh - 200px - 40px);
      left: calc(100vw - 200px - 40px);
      width: 200px;
      height: 200px;
      background-color: #fff;
      border-radius: 50%;
      border: 4px solid #fff;
      box-shadow: 0px 8px 24px rgba(0, 0, 0, 0.12);
      transition:
        width 0.3s ease-in-out,
        height 0.3s ease-in-out,
        top 0.3s ease-in-out,
        left 0.3s ease-in-out,
        bottom 0.3s ease-in-out,
        right 0.3s ease-in-out,
        border-radius 0.3s ease-in-out;
      overflow: hidden;
      cursor: pointer;
    }
    /* Expanded state: container is larger and rectangular */
    #heygen-streaming-embed.expand {
      width: 33vw;
      height: calc(100vh - 10px);
      border-radius: 8px;
      border: 5px;
      right: auto;
      bottom: auto;
      top: 5px;                                        /* 5px from the top */
      left: calc(100vw - 33vw - 5px);
      overflow: hidden;
      cursor: default;
    }
    /* Hide overlay when not expanded */
    #heygen-streaming-embed:not(.expand) #overlay {
      display: none;
    }
    /* Video element fills the container */
    #mediaElement {
      width: 100%;
      height: 35%;
      object-fit: cover;
      position: relative;
      top: 0;
      left: 0;
      display: block;
      z-index: 1;
      border: 5px solid #d50060;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
      border-bottom-left-radius: 0;
      border-bottom-right-radius: 0;
      box-sizing: border-box;

    }
    /* Fallback image styling */
    #fallbackImage {
      position: relative;
      top: 0;
      left: 0;
      width: 100%;
      height: 35%;
      object-fit: cover;
      z-index: 2;
      /* Always visible when no session is active */
      display: block;
      border: 5px solid #d50060;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
      border-bottom-left-radius: 0;
      border-bottom-right-radius: 0;
      box-sizing: border-box;
    }

    #heygen-streaming-embed.expand #fallbackImage {
      filter: brightness(70%);
    }

    /* Start button (only in expanded mode when no session is active) */
    #startSessionBtn {
      position: absolute;
      top: 15%;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1rem;
      background-color: #d50060; /* your pink */
      color: white;               /* text color */
      padding: 10px 20px;
      border-radius: 30px;       /* pill shape */
      cursor: pointer;
      z-index: 100;
      font-weight: bold;
      text-align: center;
      border: none;         /* remove border */
      box-shadow: none;
      font-family: 'Inter', sans‑serif;
    }
    .loader {
      display: none;
      border: 7px solid #f3f3f3;    /* Light grey */
      border-top: 7px solid #d50060;/* Blue */
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 2s linear infinite;
      position: absolute;            /* so it sits on top of the video/avatar */
      top: 18%;
      left: 50%;
      z-index: 100;
    }

    /* now include the translation + the rotation in every frame */
    @keyframes spin {
      from {
        transform: translate(-50%, -50%) rotate(0deg);
      }
      to {
        transform: translate(-50%, -50%) rotate(360deg);
      }
    }

    /* 3) when the button has “loading”, hide the button… */
    #startSessionBtn.loading {
      display: none;
      visibility: hidden;
      transition-delay: 0s;
    }

    /* 4) …and show the loader right after it in the DOM */
    #startSessionBtn.loading ~ .loader {
      display: block;
    }
    /* Minimize button base */
    #minimizeBtn {
      display: none;            /* hide by default */
      position: absolute;
      top: 8px;
      left: 8px;
      background: transparent;
      border: none;
      color: #fff;
      font-size: 3rem;
      line-height: 1;
      cursor: pointer;
      z-index: 200;
      text-shadow:
        0 0 7px black;
      background: transparent;
    }

    /* Show only when expanded */
    #heygen-streaming-embed.expand #minimizeBtn {
      display: block;
    }
    /* Overlay for chat and controls */
    #overlay {
      position: absolute;
      bottom: 0;
      width: 100%;
      /* Define a fixed or relative height for the overlay if needed */
      height: 65%; /* This is an example value; adjust as desired */
      background: #d50060;
      color: #fff;
      padding: 5px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: 5px;
      z-index: 3;
    }

     /* Chat history styling: always visible and flexible */
    #chatHistory {
      flex: 1;
      overflow-y: auto;
      font-size: 1rem;
      background: white;
      padding: 5px;
      border-radius: 4px;
      color: black;
      display: flex;
      flex-direction: column;
      gap: 5px;
      font-family: 'Inter', sans‑serif;
    }
    /* New chat bubble styling for user messages */
    .chat-message {
      max-width: 70%;
      padding: 10px 15px;
      margin: 5px;
      border-radius: 15px;
      background-color: #d50060;
      color: #fff;
      align-self: flex-end;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }


    /* Talk section controls */
    #talk-section {
      display: flex;
      align-items: center;
    }
    #talk-section button, #talk-section input {
      padding: 5px;
      border: none;
      border-radius: 4px;
      margin-right: 5px;
      font-size: 0.9rem;
      font-weight: bold;
      font-family: 'Inter', sans‑serif;
    }
    #talk-section input {
      flex-grow: 1;
      border: 1px solid #ccc;
      color: #000;
    }
    #talk-section button {
      background-color: #FFB6C1;
      color: black;
      cursor: pointer;
      font-weight: bold;
      font-family: 'Inter', sans‑serif;
    }
    /* Toggle chat history button style */
    #toggleChatBtn {
      background-color: #d50060;
      color: #fff;
      cursor: pointer;
      font-weight: bold;
      font-family: 'Inter', sans‑serif;
    }
    /* Chat prompt styling: visible only in minimized mode */
    #chatPrompt {
      position: absolute;
      top: 80%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 0.7rem;
      background-color: #d50060; /* your pink */
      color: white;               /* text color */
      padding: 7px 15px;
      border-radius: 30px;       /* pill shape */
      cursor: pointer;
      z-index: 10;
      font-weight: bold;
      text-align: center;
      font-family: 'Inter', sans‑serif;
    }
    /* Hide the chat prompt when the container is expanded */
    #heygen-streaming-embed.expand #chatPrompt {
      display: none;
    }
    /* 1) Hide everything when minimized & no session */
    #heygen-streaming-embed:not(.expand) > * {
      display: none !important;
    }

    /* 2) Show & stretch only the fallback image */
    #heygen-streaming-embed:not(.expand):not(.session-active) > #fallbackImage {
      display: block !important;
      width: 100% !important;
      height: 100% !important;
      object-fit: cover !important;
      border: none !important;
      border-radius: inherit !important;
    }

    /* 3) Keep the chat prompt visible when minimized */
    #heygen-streaming-embed:not(.expand):not(.session-active) > #chatPrompt {
      display: block !important;
    }

    /* 4) Minimized & session-active: show ONLY the mediaElement, filling the circle */
    #heygen-streaming-embed:not(.expand).session-active > #mediaElement {
      display: block !important;
      width: 100% !important;
      height: 100% !important;
      object-fit: cover !important;
      border: none !important;
      border-radius: inherit !important;
    }
    /* Mic button: same height as input, minimal padding */
    #micBtn {
      background: none;
      border: none;
      padding: 0;                  /* kill default padding */
      margin: 0;                   /* kill default margin */
      height: 1.7rem;              /* match your input’s ~2.5rem height */
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    /* SVG: slightly smaller than the button, perfectly centered */
    #micBtn svg {
      width: 1.25rem;
      height: 1.25rem;
      stroke: currentColor;        /* inherit your button/text color */
    }
    /* when not recording: show only the outline mic */
    #micBtn #micIcon   { display: block; }
    #micBtn #recIcon   { display: none; }

    /* when recording: show the white solid mic */
    #micBtn.recording #micIcon { display: none; }
    #micBtn.recording #recIcon {
      display: block;
      fill: #fff;        /* white SVG fill */
      stroke: #fff;      /* if your icon uses stroke */
    }
    #micBtn.recording {
      background-color: #d50000;  /* red background */
    }

  </style>
  <!-- Include LiveKit Client Library -->
  <script src="https://cdn.jsdelivr.net/npm/livekit-client/dist/livekit-client.umd.min.js"></script>
</head>
<body>
<!-- Header / Navigation -->
<header>
  <nav>
    <ul>
      <li><a href="#">Home</a></li>
      <li><a href="#">Features</a></li>
      <li><a href="#">Contact</a></li>
    </ul>
  </nav>
</header>

<!-- Main Content -->
<main>
  <h1>Voorbeeld pagina om te chatten met Imce</h1>
  <p>
    Welkom op onze website! Hier kun je kennismaken met onze interactieve avatar Imce. Imce staat voor je klaar om je te helpen en vragen te beantwoorden. Begin een gesprek en ontdek hoe Imce jouw ervaring persoonlijker maakt.
  </p>
</main>

<!-- Footer -->
<footer>
  <p>&copy; 2025 MMG Waalre</p>
</footer>

<!-- Streaming Container (Avatar) -->
<div id="heygen-streaming-embed">
  <!-- Chat prompt overlay for minimized state -->
  <div id="chatPrompt">Klik hier om te chatten</div>
  <!-- Fallback image is always shown when no session is active -->
  <img id="fallbackImage" src="{{ url_for('static', filename='preview_target.webp') }}" alt="Avatar fallback">
  <!-- The video element fills the container (hidden until session starts) -->
  <video id="mediaElement" autoplay playsinline style="display: none;"></video>
  <!-- Start button shown when expanded and no session is active -->
  <button id="startSessionBtn">Start</button>
  <button id="minimizeBtn" title="Minimize">×</button>
  <div class="loader"></div>
  <!-- Overlay for chat and controls -->
  <div id="overlay">
    <!-- Chat History: shows only chat messages -->
    <div id="chatHistory"></div>
    <!-- Talk Section with Toggle, Text Field, Talk Button, and Microphone Button -->
    <div id="talk-section">
      <input id="taskInput" type="text" placeholder="Je vraag of bericht ...">
      <button id="talkBtn">Stuur</button>
      <button id="micBtn" title="Start spraak">
        <!-- normal outline mic -->
        <svg id="micIcon" fill="#000000" width="800px" height="800px" viewBox="0 0 36 36" version="1.1"  preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <title>microphone-solid</title>
          <path d="M18,24c3.9,0,7-3.1,7-7V9c0-3.9-3.1-7-7-7s-7,3.1-7,7v8C11,20.9,14.1,24,18,24z" class="clr-i-solid clr-i-solid-path-1"></path>
          <path d="M30,17h-2c0,5.5-4.5,10-10,10S8,22.5,8,17H6c0,6.3,4.8,11.4,11,11.9V32h-3c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1
		s-0.4-1-1-1h-3v-3.1C25.2,28.4,30,23.3,30,17z" class="clr-i-solid clr-i-solid-path-2"></path>
        </svg>
        <!-- recording solid mic (white) -->
        <svg id="recIcon" width="800px" height="800px" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 10L3 14M7.5 6L7.5 18M12 3V21M16.5 6V18M21 10V14" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
  </div>
</div>

<!-- Streaming API Script -->
<script type="module" src="{{ url_for('static', filename='streaming.js') }}"></script>
</body>
</html>
